{% extends "admin/admin_base.html" %}

{% block title %}Supprimer la formation {{ training.title }} - Oloustream Admin{% endblock %}

{% block extra_css %}
<style>
    /* ==================== VARIABLES LOCALES ==================== */
    :root {
        --primary-400: #c084fc;
        --primary-500: #a855f7;
        --primary-600: #9333ea;
        --primary-700: #7c3aed;
        --surface-100: #f4f4f5;
        --surface-200: #e4e4e7;
        --surface-300: #d4d4d8;
        --surface-400: #a1a1aa;
        --surface-500: #71717a;
        --surface-600: #52525b;
        --surface-700: #3f3f46;
        --surface-800: #27272a;
        --surface-850: #1f1f23;
        --surface-900: #18181b;
        --error-400: #f87171;
        --error-500: #ef4444;
        --error-600: #dc2626;
        --error-700: #b91c1c;
        --warning-400: #fbbf24;
        --warning-500: #f59e0b;
        --success-color: #34d399;
        --info-color: #60a5fa;
    }

    /* ==================== PAGE WRAPPER ==================== */
    .delete-page-wrapper {
        min-height: calc(100vh - var(--header-height, 70px) - 3rem);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        position: relative;
        overflow: hidden;
    }

    /* Background animated gradient */
    .delete-page-wrapper::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
            circle at 30% 40%,
            rgba(239, 68, 68, 0.08) 0%,
            transparent 50%
        ),
        radial-gradient(
            circle at 70% 60%,
            rgba(147, 51, 234, 0.05) 0%,
            transparent 50%
        );
        animation: bgFloat 20s ease-in-out infinite alternate;
        pointer-events: none;
    }

    @keyframes bgFloat {
        0% { transform: translate(0, 0) rotate(0deg); }
        100% { transform: translate(-20px, -20px) rotate(3deg); }
    }

    /* ==================== MAIN CARD ==================== */
    .delete-card {
        position: relative;
        width: 100%;
        max-width: 540px;
        background: linear-gradient(145deg, #1f1f23, #18181b);
        border: 1px solid rgba(239, 68, 68, 0.15);
        border-radius: 20px;
        overflow: hidden;
        animation: cardAppear 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                    0 0 0 1px rgba(239, 68, 68, 0.08);
    }

    @keyframes cardAppear {
        0% {
            opacity: 0;
            transform: scale(0.95) translateY(20px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    /* Animated border glow */
    .delete-card::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 20px;
        padding: 1px;
        background: linear-gradient(
            135deg,
            rgba(239, 68, 68, 0.4),
            rgba(239, 68, 68, 0.1),
            rgba(147, 51, 234, 0.15),
            rgba(239, 68, 68, 0.1),
            rgba(239, 68, 68, 0.4)
        );
        background-size: 300% 300%;
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        animation: borderGlow 4s ease infinite;
        pointer-events: none;
    }

    @keyframes borderGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* ==================== CARD HEADER ==================== */
    .delete-card-header {
        position: relative;
        padding: 2.5rem 2rem 2rem;
        text-align: center;
        background: linear-gradient(180deg, 
            rgba(239, 68, 68, 0.12) 0%, 
            rgba(239, 68, 68, 0.03) 100%
        );
        border-bottom: 1px solid rgba(239, 68, 68, 0.1);
    }

    /* Danger Icon */
    .danger-icon-wrapper {
        position: relative;
        width: 88px;
        height: 88px;
        margin: 0 auto 1.5rem;
    }

    .danger-icon-bg {
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, 
            rgba(239, 68, 68, 0.15), 
            rgba(239, 68, 68, 0.05)
        );
        border-radius: 50%;
        border: 2px solid rgba(239, 68, 68, 0.3);
        animation: iconPulse 2.5s ease-in-out infinite;
    }

    @keyframes iconPulse {
        0%, 100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
        }
        50% {
            transform: scale(1.03);
            box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
        }
    }

    .danger-icon {
        position: relative;
        z-index: 1;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .danger-icon i {
        font-size: 2.75rem;
        color: var(--error-400);
        filter: drop-shadow(0 0 15px rgba(239, 68, 68, 0.5));
        animation: iconFloat 3s ease-in-out infinite;
    }

    @keyframes iconFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    .delete-card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--surface-100);
        margin: 0 0 0.5rem;
        letter-spacing: -0.01em;
    }

    .delete-card-subtitle {
        font-size: 0.9375rem;
        color: var(--surface-400);
        margin: 0;
    }

    /* ==================== CARD BODY ==================== */
    .delete-card-body {
        padding: 2rem;
    }

    /* Training Preview */
    .training-preview {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.25rem;
        background: linear-gradient(135deg, #27272a, #1f1f23);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        margin-bottom: 1.5rem;
        transition: all 0.25s ease;
    }

    .training-preview:hover {
        border-color: rgba(147, 51, 234, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.3);
    }

    .training-icon {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
        box-shadow: 0 4px 15px rgba(147, 51, 234, 0.35);
    }

    .training-icon i {
        font-size: 1.75rem;
        color: white;
    }

    .training-info {
        flex: 1;
        min-width: 0;
    }

    .training-title {
        font-size: 1.0625rem;
        font-weight: 600;
        color: var(--surface-100);
        margin: 0 0 0.375rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .training-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .training-meta-item {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-size: 0.8125rem;
        color: var(--surface-500);
    }

    .training-meta-item i {
        font-size: 0.9375rem;
    }

    .training-badge {
        padding: 0.25rem 0.625rem;
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
        color: #818cf8;
    }

    /* Warning Box */
    .warning-box {
        display: flex;
        gap: 1rem;
        padding: 1.25rem;
        background: linear-gradient(135deg, 
            rgba(245, 158, 11, 0.1), 
            rgba(245, 158, 11, 0.05)
        );
        border: 1px solid rgba(245, 158, 11, 0.25);
        border-radius: 12px;
        margin-bottom: 1.5rem;
    }

    .warning-box-icon {
        flex-shrink: 0;
        width: 42px;
        height: 42px;
        background: rgba(245, 158, 11, 0.15);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .warning-box-icon i {
        font-size: 1.375rem;
        color: var(--warning-400);
    }

    .warning-box-content {
        flex: 1;
    }

    .warning-box-title {
        font-size: 0.9375rem;
        font-weight: 600;
        color: var(--warning-400);
        margin: 0 0 0.375rem;
    }

    .warning-box-text {
        font-size: 0.875rem;
        color: var(--surface-300);
        margin: 0;
        line-height: 1.6;
    }

    .warning-box-text strong {
        color: var(--error-400);
    }

    /* Consequences List */
    .consequences-section {
        margin-bottom: 1.5rem;
    }

    .consequences-title {
        font-size: 0.6875rem;
        font-weight: 700;
        color: var(--surface-500);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .consequences-title::after {
        content: '';
        flex: 1;
        height: 1px;
        background: linear-gradient(90deg, rgba(255, 255, 255, 0.08), transparent);
    }

    .consequences-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 0.5rem;
    }

    .consequences-list li {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        background: rgba(239, 68, 68, 0.05);
        border: 1px solid rgba(239, 68, 68, 0.1);
        border-radius: 10px;
        font-size: 0.875rem;
        color: var(--surface-300);
        transition: all 0.2s ease;
    }

    .consequences-list li:hover {
        background: rgba(239, 68, 68, 0.08);
        border-color: rgba(239, 68, 68, 0.2);
        transform: translateX(4px);
    }

    .consequences-list li i {
        font-size: 1.125rem;
        color: var(--error-400);
        flex-shrink: 0;
    }

    /* Confirm Checkbox */
    .confirm-checkbox-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 0.875rem;
        padding: 1.125rem 1.25rem;
        background: linear-gradient(135deg, 
            rgba(239, 68, 68, 0.06), 
            rgba(239, 68, 68, 0.02)
        );
        border: 1px solid rgba(239, 68, 68, 0.15);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.25s ease;
        margin-bottom: 1.5rem;
    }

    .confirm-checkbox-wrapper:hover {
        background: linear-gradient(135deg, 
            rgba(239, 68, 68, 0.1), 
            rgba(239, 68, 68, 0.04)
        );
        border-color: rgba(239, 68, 68, 0.25);
    }

    .confirm-checkbox-wrapper.checked {
        background: linear-gradient(135deg, 
            rgba(239, 68, 68, 0.12), 
            rgba(239, 68, 68, 0.06)
        );
        border-color: rgba(239, 68, 68, 0.35);
    }

    /* Custom Checkbox */
    .custom-checkbox {
        position: relative;
        width: 24px;
        height: 24px;
        flex-shrink: 0;
        margin-top: 0.125rem;
    }

    .custom-checkbox input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
        z-index: 2;
    }

    .checkbox-visual {
        position: absolute;
        inset: 0;
        background: var(--surface-700);
        border: 2px solid var(--surface-500);
        border-radius: 6px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .checkbox-visual i {
        font-size: 0.875rem;
        color: white;
        opacity: 0;
        transform: scale(0.5);
        transition: all 0.2s ease;
    }

    .custom-checkbox input:checked ~ .checkbox-visual {
        background: linear-gradient(135deg, var(--error-500), var(--error-600));
        border-color: var(--error-500);
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
    }

    .custom-checkbox input:checked ~ .checkbox-visual i {
        opacity: 1;
        transform: scale(1);
    }

    .custom-checkbox input:focus ~ .checkbox-visual {
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }

    .confirm-checkbox-text {
        font-size: 0.9375rem;
        color: var(--surface-300);
        line-height: 1.6;
    }

    .confirm-checkbox-text strong {
        color: var(--error-400);
        font-weight: 600;
    }

    /* ==================== ACTION BUTTONS ==================== */
    .actions-container {
        display: flex;
        gap: 0.875rem;
    }

    .btn {
        flex: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.9375rem 1.5rem;
        font-size: 0.9375rem;
        font-weight: 600;
        font-family: inherit;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.25s ease;
        position: relative;
        overflow: hidden;
    }

    .btn i {
        font-size: 1.125rem;
        transition: transform 0.2s ease;
    }

    /* Cancel Button */
    .btn-cancel {
        background: var(--surface-700);
        color: var(--surface-200);
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .btn-cancel:hover {
        background: var(--surface-600);
        color: var(--surface-100);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px -5px rgba(0, 0, 0, 0.3);
    }

    .btn-cancel:hover i {
        transform: rotate(-90deg);
    }

    /* Delete Button */
    .btn-delete {
        background: linear-gradient(135deg, var(--error-500), var(--error-600));
        color: white;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.35),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .btn-delete::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, 
            rgba(255, 255, 255, 0.15), 
            transparent 50%
        );
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .btn-delete:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.45),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }

    .btn-delete:hover::before {
        opacity: 1;
    }

    .btn-delete:hover i {
        transform: translateX(3px);
    }

    .btn-delete:active {
        transform: translateY(0);
    }

    /* Disabled State */
    .btn-delete:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }

    .btn-delete:disabled::before {
        display: none;
    }

    /* Loading State */
    .btn-delete.loading {
        pointer-events: none;
    }

    .btn-delete.loading .btn-text {
        opacity: 0;
    }

    .btn-delete.loading::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* ==================== CARD FOOTER ==================== */
    .delete-card-footer {
        padding: 1rem 2rem;
        background: rgba(0, 0, 0, 0.25);
        border-top: 1px solid rgba(255, 255, 255, 0.04);
    }

    .footer-note {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.8125rem;
        color: var(--surface-500);
        margin: 0;
    }

    .footer-note i {
        font-size: 1rem;
        color: var(--surface-400);
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 576px) {
        .delete-page-wrapper {
            padding: 1rem;
            align-items: flex-start;
            padding-top: 1.5rem;
        }

        .delete-card {
            border-radius: 16px;
        }

        .delete-card-header {
            padding: 2rem 1.5rem 1.5rem;
        }

        .danger-icon-wrapper {
            width: 72px;
            height: 72px;
        }

        .danger-icon i {
            font-size: 2.25rem;
        }

        .delete-card-title {
            font-size: 1.25rem;
        }

        .delete-card-body {
            padding: 1.5rem;
        }

        .training-preview {
            flex-direction: column;
            text-align: center;
            gap: 0.875rem;
        }

        .training-meta {
            justify-content: center;
        }

        .warning-box {
            flex-direction: column;
            text-align: center;
            gap: 0.875rem;
        }

        .warning-box-icon {
            align-self: center;
        }

        .actions-container {
            flex-direction: column-reverse;
        }

        .btn {
            width: 100%;
        }
    }

    /* ==================== REDUCED MOTION ==================== */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="delete-page-wrapper">
    <div class="delete-card">
        <!-- ========== HEADER ========== -->
        <div class="delete-card-header">
            <div class="danger-icon-wrapper">
                <div class="danger-icon-bg"></div>
                <div class="danger-icon">
                    <i class="ph ph-warning-circle"></i>
                </div>
            </div>
            <h1 class="delete-card-title">Supprimer cette formation ?</h1>
            <p class="delete-card-subtitle">Cette action est définitive et irréversible</p>
        </div>

        <!-- ========== BODY ========== -->
        <div class="delete-card-body">
            <!-- Training Preview -->
            <div class="training-preview">
                <div class="training-icon">
                    <i class="ph ph-graduation-cap"></i>
                </div>
                <div class="training-info">
                    <h3 class="training-title">{{ training.title }}</h3>
                    <div class="training-meta">
                        {% if training.category %}
                        <span class="training-meta-item">
                            <i class="ph ph-folder"></i>
                            {{ training.category.name }}
                        </span>
                        {% endif %}
                        <span class="training-badge">{{ training.get_level_display }}</span>
                        {% if training.duration_hours %}
                        <span class="training-meta-item">
                            <i class="ph ph-clock"></i>
                            {{ training.duration_hours }}h
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Warning Box -->
            <div class="warning-box">
                <div class="warning-box-icon">
                    <i class="ph ph-warning"></i>
                </div>
                <div class="warning-box-content">
                    <h4 class="warning-box-title">Attention importante</h4>
                    <p class="warning-box-text">
                        Cette action est <strong>irréversible</strong>. Une fois supprimée, 
                        la formation et toutes ses données associées seront définitivement perdues.
                    </p>
                </div>
            </div>

            <!-- Consequences List -->
            <div class="consequences-section">
                <h4 class="consequences-title">Impact de la suppression</h4>
                <ul class="consequences-list">
                    <li>
                        <i class="ph ph-graduation-cap"></i>
                        <span>Le programme de formation sera supprimé</span>
                    </li>
                    <li>
                        <i class="ph ph-users"></i>
                        <span>Les inscriptions associées seront perdues</span>
                    </li>
                    <li>
                        <i class="ph ph-file-x"></i>
                        <span>Les documents (brochure, image) seront effacés</span>
                    </li>
                    <li>
                        <i class="ph ph-chart-line-down"></i>
                        <span>Les statistiques ne seront plus accessibles</span>
                    </li>
                </ul>
            </div>

            <!-- Confirmation Form -->
            <form method="post" id="deleteForm">
                {% csrf_token %}
                
                <label class="confirm-checkbox-wrapper" id="checkboxWrapper">
                    <div class="custom-checkbox">
                        <input type="checkbox" id="confirmDelete" required>
                        <div class="checkbox-visual">
                            <i class="ph ph-check-bold"></i>
                        </div>
                    </div>
                    <span class="confirm-checkbox-text">
                        Je confirme vouloir supprimer définitivement la formation 
                        <strong>« {{ training.title }} »</strong> et comprends que cette 
                        action ne peut pas être annulée.
                    </span>
                </label>

                <!-- Actions -->
                <div class="actions-container">
                    <a href="{% url 'dashboard:trainings_list' %}" class="btn btn-cancel">
                        <i class="ph ph-arrow-left"></i>
                        <span>Annuler</span>
                    </a>
                    <button type="submit" class="btn btn-delete" id="deleteBtn" disabled>
                        <i class="ph ph-trash"></i>
                        <span class="btn-text">Supprimer définitivement</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- ========== FOOTER ========== -->
        <div class="delete-card-footer">
            <p class="footer-note">
                <i class="ph ph-shield-warning"></i>
                Cette opération sera enregistrée dans l'historique
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('confirmDelete');
    const checkboxWrapper = document.getElementById('checkboxWrapper');
    const deleteBtn = document.getElementById('deleteBtn');
    const form = document.getElementById('deleteForm');

    // Toggle checkbox visual state
    function updateCheckboxState() {
        if (checkbox.checked) {
            checkboxWrapper.classList.add('checked');
            deleteBtn.disabled = false;
        } else {
            checkboxWrapper.classList.remove('checked');
            deleteBtn.disabled = true;
        }
    }

    checkbox.addEventListener('change', updateCheckboxState);

    // Form submission
    form.addEventListener('submit', function(e) {
        if (!checkbox.checked) {
            e.preventDefault();
            return false;
        }

        // Add loading state
        deleteBtn.classList.add('loading');
        deleteBtn.disabled = true;
    });

    // Keyboard accessibility
    checkboxWrapper.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            checkbox.checked = !checkbox.checked;
            updateCheckboxState();
        }
    });

    // Add ripple effect on button click
    document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            if (this.disabled) return;
            
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            const ripple = document.createElement('span');
            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;
            
            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        });
    });

    // Shake animation on disabled button click
    deleteBtn.addEventListener('click', function(e) {
        if (this.disabled) {
            e.preventDefault();
            checkboxWrapper.style.animation = 'shake 0.5s ease';
            setTimeout(() => {
                checkboxWrapper.style.animation = '';
            }, 500);
        }
    });

    // Add keyframes dynamically
    const style = document.createElement('style');
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}