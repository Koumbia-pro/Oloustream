{% extends "base.html" %}
{% block title %}Mot de passe oublié - Oloustream{% endblock %}

{% block content %}

<style>
  /* Conteneur global du bloc */
  .row.justify-content-center {
    min-height: calc(100vh - 160px);
    align-items: center;
    padding: 24px 12px;
  }

  /* Carte du formulaire */
  .row.justify-content-center .col-md-6 {
    background: #ffffff;
    border: 1px solid rgba(0,0,0,.08);
    border-radius: 14px;
    padding: 28px 26px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
  }

  /* Titres et texte */
  .row.justify-content-center h2 {
    margin: 0 0 10px;
    font-weight: 700;
    letter-spacing: .2px;
    color: #050505;
  }

  .row.justify-content-center p {
    margin: 0 0 18px;
    color: #5b6472;
    line-height: 1.45;
  }

  /* Style des champs générés par {{ form.as_p }} */
  .row.justify-content-center form p {
    margin: 0 0 14px;
  }

  .row.justify-content-center label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
    color: #2a2f3a;
  }

  .row.justify-content-center input[type="email"],
  .row.justify-content-center input[type="text"],
  .row.justify-content-center input[type="password"] {
    width: 100%;
    padding: 12px 12px;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 10px;
    outline: none;
    transition: border-color .15s ease, box-shadow .15s ease;
    background: #fff;
  }

  .row.justify-content-center input:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 .2rem rgba(13,110,253,.15);
  }

  /* Aide/erreurs Django */
  .row.justify-content-center .helptext {
    display: block;
    margin-top: 6px;
    font-size: .9rem;
    color: #6b7280;
  }

  .row.justify-content-center ul.errorlist {
    margin: 8px 0 0;
    padding: 10px 12px;
    list-style: none;
    border-radius: 10px;
    background: rgba(220,53,69,.08);
    border: 1px solid rgba(220,53,69,.25);
    color: #b02a37;
  }

  .row.justify-content-center ul.errorlist li {
    margin: 0;
  }

  /* Bouton */
  .row.justify-content-center .btn.btn-primary {
    width: 100%;
    padding: 11px 14px;
    border-radius: 10px;
    font-weight: 700;
    letter-spacing: .2px;
  }

  /* Petits écrans */
  @media (max-width: 576px) {
    .row.justify-content-center .col-md-6 {
      padding: 22px 18px;
      border-radius: 12px;
    }
  }
</style>

<div class="row justify-content-center">
    <div class="col-md-6">
        <h2>Mot de passe oublié</h2>
        <p>Entrez votre adresse email pour recevoir un lien de réinitialisation.</p>
        <form method="post" id="forgot-form">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary" id="submit-btn">Envoyer</button>
        </form>
    </div>
</div>

<script>
  (function () {
    const form = document.getElementById('forgot-form');
    if (!form) return;

    // Trouver le premier champ email (ou fallback sur le premier input)
    const emailInput =
      form.querySelector('input[type="email"]') ||
      form.querySelector('input[name="email"]') ||
      form.querySelector('input');

    const submitBtn = document.getElementById('submit-btn');

    // Accessibilité: lier label -> input si Django ne l'a pas fait correctement
    if (emailInput && !emailInput.id) {
      emailInput.id = 'id_email_autogen';
      const label = form.querySelector('label');
      if (label && !label.getAttribute('for')) label.setAttribute('for', emailInput.id);
    }

    // Placeholder + autofocus
    if (emailInput) {
      if (!emailInput.placeholder) emailInput.placeholder = 'ex: nom@domaine.com';
      emailInput.autocomplete = emailInput.autocomplete || 'email';
      emailInput.inputMode = 'email';
      emailInput.focus({ preventScroll: true });
    }

    // Désactiver le bouton pendant l'envoi + validation simple côté client
    form.addEventListener('submit', function (e) {
      if (emailInput) {
        const value = (emailInput.value || '').trim();

        // Validation légère (ne remplace pas la validation serveur)
        const looksLikeEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        if (!looksLikeEmail) {
          e.preventDefault();
          emailInput.focus();
          emailInput.setCustomValidity("Veuillez entrer une adresse email valide.");
          emailInput.reportValidity();
          emailInput.setCustomValidity("");
          return;
        }
      }

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.dataset.originalText = submitBtn.textContent;
        submitBtn.textContent = "Envoi en cours...";
      }
    });

    // Réactiver si l'utilisateur modifie le champ après une erreur côté serveur
    if (emailInput && submitBtn) {
      emailInput.addEventListener('input', function () {
        if (submitBtn.disabled) {
          submitBtn.disabled = false;
          submitBtn.textContent = submitBtn.dataset.originalText || "Envoyer";
        }
      });
    }
  })();
</script>

{% endblock %}